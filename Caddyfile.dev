# Zeen Connect - Development Caddy Configuration
# Copy this file to /etc/caddy/Caddyfile and update with your domain
#
# Usage:
#   sudo cp Caddyfile.dev /etc/caddy/Caddyfile
#   sudo nano /etc/caddy/Caddyfile  # Update domain and email
#   sudo systemctl restart caddy

{
    # Your email for Let's Encrypt SSL certificates
    email admin@zeenconnect.com
}

# Shared snippet for Vite HMR support
(vite_hmr) {
    # Vite HMR WebSocket connections
    @vite_ws {
        path /@vite/*
        header Connection *Upgrade*
        header Upgrade websocket
    }
    handle @vite_ws {
        reverse_proxy localhost:5174
    }

    # Vite assets and HMR paths
    @vite_assets {
        path /@vite/*
        path /@id/*
        path /@fs/*
        path /node_modules/*
        path /resources/*
    }
    handle @vite_assets {
        reverse_proxy localhost:5174
    }
}

# Main development domain
dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
}

# Admin subdomain
admin.dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
}

# Console subdomain
console.dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
}

# Auth subdomain
auth.dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
}

# Payments subdomain
payments.dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
}

# Wildcard subdomain for provider sites (e.g., {provider}.dev.zeenconnect.com)
# Note: Wildcard SSL requires DNS challenge. Configure your DNS provider:
# https://caddyserver.com/docs/automatic-https#dns-challenge
*.dev.zeenconnect.com {
    import vite_hmr

    reverse_proxy localhost:8080 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }

    tls {
        dns cloudflare {env.CLOUDFLARE_API_TOKEN}
    }
}
